# v1.1 — Architecture Compliance & Structural Integrity

v1.0 roadmap items were all marked complete, but a thorough review reveals
structural violations and gaps. This version fixes them.

## Issue 1: Clean Architecture Violations in Modules

**Rule**: modules/ must depend ONLY on domain/ and the standard library.
Four modules violate this by importing from kernel/ or other modules:

- [ ] **gap_analyzer/core.py** — imports `kernel.roadmap` (3 functions) and `modules.failure_analyzer.core`
  - Fix: inject roadmap data (version, unchecked items) as function parameters
  - Fix: inject failure analysis function via parameter instead of direct import
- [ ] **planner/core.py** — imports `kernel.roadmap.get_current_version`
  - Fix: accept `current_version: str` as a parameter (already in IterationPlan)
- [ ] **executor/core.py** — imports `kernel.config.ROOT` to write prompt file
  - Fix: accept `prompt_dir: Path` as constructor parameter
- [ ] **reporter/core.py** — imports `kernel.console` for TUI output
  - Fix: remove console calls from module; let the bridge/wiring layer handle display

## Issue 2: Bridge Layer Needs Updating After Module Fixes

Once modules no longer import kernel, the bridge/wiring layer must supply
the dependencies that were previously fetched internally by the modules.

- [ ] Update `adapters/gap_analyzer_bridge.py` to pass roadmap data and failure analyzer
- [ ] Update `adapters/planner_bridge.py` to pass current version
- [ ] Update `adapters/executor_bridge.py` to pass prompt directory
- [ ] Update `adapters/reporter_bridge.py` to handle console output
- [ ] Update `wiring.py` call sites to match new signatures

## Issue 3: Module Tests Must Verify Isolation

- [ ] Add import-guard tests: assert no module core.py imports kernel/ or other modules/
- [ ] Verify all existing module tests still pass after refactoring

## Issue 4: Conformance Tests Must Reflect New Signatures

- [ ] Update conformance tests for gap_analyzer, planner, executor, reporter
- [ ] All conformance tests pass with refactored interfaces

## Quality Gate

- [ ] All code passes: `ruff check . && ruff format --check . && pyright && pytest --cov --cov-fail-under=80`
- [ ] Zero imports from kernel/ or cross-module imports in any modules/*/core.py
